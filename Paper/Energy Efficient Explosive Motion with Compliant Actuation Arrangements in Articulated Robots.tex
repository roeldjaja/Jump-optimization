%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%2345678901234567890123456789012345678901234567890123456789012345678901234567890
%        1         2         3         4         5         6         7         8

\documentclass[letterpaper, 10 pt, conference]{ieeeconf}  % Comment this line out if you need a4paper

%\documentclass[a4paper, 10pt, conference]{ieeeconf}      % Use this line for a4 paper

\IEEEoverridecommandlockouts                              % This command is only needed if 
                                                          % you want to use the \thanks command

\overrideIEEEmargins                                      % Needed to meet printer requirements.

% See the \addtolength command later in the file to balance the column lengths
% on the last page of the document

% The following packages can be found on http:\\www.ctan.org
%\usepackage{graphics} % for pdf, bitmapped graphics files
%\usepackage{epsfig} % for postscript graphics files
%\usepackage{mathptmx} % assumes new font selection scheme installed
%\usepackage{times} % assumes new font selection scheme installed
\usepackage{amsmath} % assumes amsmath package installed
\usepackage{amssymb}  % assumes amsmath package installed
\usepackage{accents}
\newcommand\ubar[1]{%
	\underaccent{\bar}{#1}}
\usepackage{framed}
\usepackage{cite}

\title{\LARGE \bf
Energy Efficient Explosive Motion with Compliant Actuation Arrangements in Articulated Robots*
}


\author{Roel Djajadiningrat$^{1}$, Wesley Roozing$^{2}$ and Nikolaos G. Tsagarakis$^{3}$% <-this % stops a space
\thanks{*Supported by \textbf{EU PROJECT???} }% <-this % stops a space
\thanks{$^{1}$ Roel Djajadiningrat is a M.Sc student at the Department of Mechanical Engineering, TU Delft and a visiting student at Istituto Italiano di Tecnologia;
        {\tt\ r.djajadiningrat@student.tudelft.nl}
  }%
\thanks{$^{2}$Wesley Roozing is with the Department of Advanced Robotics,
	(Fondazione) Istituto Italiano di Tecnologia, via Morego,
	30, 16163 Genova, Italy.
        {\tt\small wesley.roozing@iit.it}
     }%
\thanks{$^{2}$Nikolaos G. Tsagarakis is with the Department of Advanced Robotics,
	(Fondazione) Istituto Italiano di Tecnologia, via Morego,
	30, 16163 Genova, Italy.
	{\tt\small nikos.tsagarakis@iit.it}        
    }%
}


\begin{document}



\maketitle
\thispagestyle{empty}
\pagestyle{empty}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{abstract}

This paper presents the motion optimization for a recently introduced asymmetric compliant actuator which provides energy efficient actuation for explosive motions such as jumping. Two actuation branches
with significantly different stiffness and energy storage capacity properties driving a single joint make up the actuator design. An optimization problem is formulated to optimize the joint trajectories for energy efficient vertical jumping motions of a 2-DoF leg as proof-of-concept. Several configurations of the asymmetric compliant actuators have been investigated. Simulation studies of the optimized jumping motions demonstrate SOMETHING. 

\end{abstract}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{INTRODUCTION}

Introduction  \\
sea's \cite{pratt1995series}\\
(parallel) compliant actuation \cite{yesilevskiy2015comparison} \cite{liu2015spear}\\
optimization in variable stiffness and compliance \cite{garabini2011optimality},\cite{velasco2013soft}   \\
biarticulated robot jumping \cite{babivc2009biarticulated}. \\
biomechanics \cite{niiyama2007mowgli}\\
inverse kinematics recursive algorihm \cite{wang1999weight} \cite{albro2000computation} \cite{albro2001optimal}\\
inverse kinematics hybrid dynamics algorithm, given desired joint accelerations, the base
accelerations and joint torques are computed \cite{nakanishi2007inverse} \\
novel design Asymmetric Compliant Actuation \cite{roozing2016design} \cite{roozing2016development} \\ 
optimization B-spline trajectories \cite{ude2000planning} \cite{babivc2009biarticulated}
objectives and constraints \cite{babivc2009biarticulated} \cite{kaphle2008optimality} \cite{wright1999numerical} \\
energy \cite{verstraten2016energy}

\section{Leg Design }

\subsection{Assymmetric Compliant Actuation}

For the concept of Assymetric Compliant Actuation, or ACA, a combination of two parallel actuation branches with very different power and stiffness properties are used as shown in Fig. \ref{fig:ACA}.

\begin{figure}[b]
	\centering
	\framebox{\parbox{3in}{Picture of ACA branches
	}}
	%\includegraphics[scale=1.0]{figurefile}
	\caption{Caption}
	\label{fig:ACA}
\end{figure}

 The Power Branch (\textit{PB}) is a rotary Series Elastic Actuator (\textit{SEA}) which consists of a high power motor \textit{M1} in series with a torsional elastic element \textit{SE}. The Energy Storage Branch (\textit{ESB}) consists of a lower power motor \textit{M2} with a high reduction linear transmission which transfers its power through a unidirectional series elastic element \textit{PE}.

\subsection{Configurations}
In nature, bi-articulated muscle structures, muscle structures that actuate multiple joints, can be found on humans and animals. An example of a bi-articulated muscle structure are the hamstrings, which span both the hip and knee joint. ACA's can be utilized to realize bi-articulated actuation by letting the PB drive a joint directly, and letting the ESB tendon span the driven joint by a pulley and in turn drive a second joint. Bi-articulation is one of three configurations of the leg considered for the jumping optimization:

  \begin{enumerate}
	\item Firstly, the ACA's are not considered and jumping optimizations are performed for the leg with fixed compliance SEA's only.
	\item Secondly, the ACA's are introduced to perform jumping optimizations on a mono-articulated version of the leg. 
	\item Lastly, a bi-articulated version of the leg is considered for optimization.
\end{enumerate}
The leg actuation configurations are shown in Fig \ref{fig:configurations}.

\begin{figure}[b]
	\centering
	\framebox{\parbox{3in}{Picture of configurations
	}}
	%\includegraphics[scale=1.0]{figurefile}
	\caption{Caption}
	\label{fig:configurations}
\end{figure}

\section{Dynamic Model}

\subsection{Forward Dynamics} 
The leg consists out of four links which are connected by the actuated ankle, knee and hip joints, denoted $q_1,q_2,q_3$, with torques $\tau_1,\tau_2,\tau_3$ as shown in Fig. \ref{fig:leg}. 
\begin{figure}[b]
	\centering
	\framebox{\parbox{3in}{Picture leg 
	}}
	%\includegraphics[scale=1.0]{figurefile}
	\caption{Caption}
	\label{fig:leg}
\end{figure}
The links have masses $m_1,m_2,m_3,m_4$ and rotational inertiae $J_1,J_2,J_3,J_4$. Their CoM is assumed to be located on the line connecting the proximal and distal joints at a distance of $r_1,r_2,r_3,r_4$ from the proximal joint for all links except for the foot; the model includes a floating base to allow for realistic modelling of the ground reaction forces (GRF). Together, the configurations of the bodies describe the system:
 \begin{equation}
x = [x_1,y_1,\theta_1,x_2,y_2,\theta_2, x_3,y_3,\theta_3,x_4,y_4,\theta_4]^T. 
\end{equation}
The Euler-Lagrange formulism with generalised coordinates $\mathbf{q} \in \mathfrak{Q} \subset \mathfrak{R}^{6}$ is used to derive the dynamic equations for the system:
 \begin{equation}
\mathbf{q}=[x_1,y_1,\theta_1,q_1,q_2,q_3]^T \label{eq:q}
 \end{equation}
leading to:
 \begin{equation}
M(\mathbf{q})\mathbf{\ddot q} = \mathbf{\tau + G(q)} - C\mathbf{(q,\dot q)\dot q -} D \mathbf{\dot q} + J_{GRF}^T \mathbf{F}_{GRF}  \label{eq:fwddyn}
 \end{equation}
Here, the damping matrix is denoted by $D = \text{diag} (0,0,0,d_1,d_2,d_3)$, the generalised actuation forces are denoted by $\tau = [0,0,0,\tau_1,\tau_2,\tau_3]$, the generalised gravitational forces are denoted by $\mathbf{G(q)}$, the Coriolis matrix is denoted by $C\mathbf{(q, \dot q)}$ and the generalised inertia matrix is denoted by $M(\mathbf{q})$. The Jacobian for the heel and toe is denoted by $J_{GRF}^T$ and the ground forces in generalised coordinates are subsequently expressed as $J_{GRF}^T \mathbf{F}_{GRF}$. Spring-dampers define $\mathbf{F}_{GRF}$ in the vertical direction and Coulomb and viscous friction define the horizontal component, proportional to the vertical forces.
 
\subsection{Inverse Dynamics}
The jumping optimizations are guided with an objective function and its criteria. These objective criteria require information concerning the active torques, available through inverse dynamics calculations. In the past an inverse dynamics formulation for the open chain, fully actuated systems derived from the recursive Newton-Euler formulation has been used to implement a recursive hybrid dynamics algorithm to integrate the system forward in time \cite{wang1999weight} \cite{albro2000computation} \cite{albro2001optimal}. However, for the optimization described in this paper we use an inverse dynamics calculation which revolves around the assumption that the motor torques from the previous time step are close to the motor commands computed at the current
time step \cite{nakanishi2007inverse}. Using this assumption with the idea of a hybrid dynamics algorithm \cite{featherstone1984robot}, the base accelerations and joint torques can be computed for given desired joint accelerations. The expression for $\mathbf{q}$ in equation (\ref{eq:q}) can be split in its passive joint and active joint components:
 \begin{equation}
\mathbf{q_p} = [x_1,y_1,\theta_1]^T, \quad  
\mathbf{q_a} = [q_1,q_1,q_3]^T.
\end{equation}
\noindent
Incorporating these into the dynamic equations in equation (\ref{eq:fwddyn}) with the knowledge that $\boldsymbol{\tau_p}=0$ leads to:
\begin{equation}
\begin{aligned}
&\left[\begin{array}{cc}  
M_{pp} & M_{aa}\\
M_{ap} & M_{aa}
\end{array} \right]
\left[\begin{array}{c}  
\mathbf{\ddot q_p}\\
\mathbf{\ddot q_a}
\end{array} \right] +
\left[\begin{array}{c}  
\mathbf{B_p (q,\dot q)}\\
\mathbf{B_a (q,\dot q)}
\end{array} \right] 
=\\
&\left[\begin{array}{c}  
\mathbf{0}\\
\boldsymbol{\tau_a}
\end{array} \right] 
+
\left[\begin{array}{c}  
J_1\\
J_2
\end{array} \right] 
\mathbf{F}_{EXT}\mathbf{(q, \dot q)}
\end{aligned}
\end{equation}		
Here, $\mathbf{B}$ denotes the gravitational, Coriolis and damping forces. Writing out the matrix multiplications to:
\begin{equation}
\begin{aligned}
&M_{pp} \mathbf{\ddot q_p}+M_{pa} \mathbf{\ddot q_a} + \mathbf{B_p (q,\dot q)} = J_1 \mathbf{F}_{EXT}\mathbf{(q, \dot q)} \\
&M_{ap} \mathbf{\ddot q_p}+M_{aa} \mathbf{\ddot q_a} + \mathbf{B_a (q,\dot q)} = J_2 \mathbf{F}_{EXT}\mathbf{(q, \dot q) + \boldsymbol{\tau_a}} 
\end{aligned}
\end{equation}
allows for an inverse formulation:
\begin{equation}
\begin{aligned}
&\left[\begin{array}{cc}  
M_{pp} & 0\\
M_{ap} &-I
\end{array} \right]
\left[\begin{array}{c}  
\mathbf{\ddot q_p}\\
\boldsymbol{\tau_a}
\end{array} \right] =\\ 
-&
\left[\begin{array}{c}  
M_{pa}\\
M_{aa}
\end{array} \right] 
\mathbf{\ddot q_a}-
\mathbf{B(q, \dot q)}+
J_{EXT}^T\mathbf{F}_{EXT}\mathbf{(q, \dot q)}.
\end{aligned}
\end{equation}	
An expression for the active torques is now easily achieved by inversion of the left-hand side mass matrix. 

\section{Dynamic Optimisation}

The search for an optimal motion requires finding the optimal active joint trajectories over time. Both the options in possible trajectories as the continuity of time pose an infinite amount of scenarios to investigate. Subsequently, the optimization we wish to perform needs to be reformulated from a a large scale trajectory optimal control problem into a finite-dimensional optimization problem.


\subsection{Trajectory Parametrization}

One can use basis splines, or B-splines, combined with a time-scale factor to reduce the complex problem into a parameter optimization \cite{ude2000planning} \cite{babivc2009biarticulated} \cite{wang1999weight} \cite{albro2001optimal}. A B-spline curve can be described by its basis functions $B_i(t)$ and control points $P=\{p_1,...,p_n\}$ which are evenly spaced over time. The active joint trajectories can be expressed as:   
 \begin{equation}
q_a(t,p) = \sum_{i=1}^{n} B_i (t) p_i
\end{equation}
Using the control points as optimization variables, an optimal set of control points can be determined and the corresponding B-splines yield optimal trajectories for the joint angle displacements, velocities and accelerations. However, the active torques pose a problem as the upper and lower bound constraints on the applied torques can become non-linear. Therefore it is chosen to express the torque limits by means of a penalty function in the objective criteria.

\subsection{Pretension position}

Explain relevance of pretension position to jumping and why it is added as an optimisation variable.

\subsection{Objective criteria}

The objective function is comprised out of three criteria which reward the performance of the leg, penalize excessive torque needed to complete a movement and maintain the postural stability of the leg. A concrete minimization of the objective functions with these criteria is represented by:   
 \begin{equation}
\min\limits J =  J_{performane}+ J_{torque}+ J_{stability}
 \end{equation}
In the following objective criteria, $c_1$, $c_2$, $c_3$ and $c_4$ denote scaling constants.\\

\subsubsection{Performance}
For the performance of the leg we distinguish two different objectives: 
\begin{enumerate}
	\item Jumping a maximum height, where the height is defined as the $y$-coordinate of the centre of mass of the leg with respect to the ground:
 \begin{equation}
	J_{performane} = -c_1 \cdot y_{CoM}^2
 \end{equation}
	\item Jumping to a certain height efficiently, where the maximum $y$-coordinate reached by the centre of mass of the leg is bound to an equality constraint and the energy use is defined as the power used for the jump:
 \begin{equation}
	J_{performane} = - c_1 \cdot E^2
 \end{equation}
	Here, $E$ is defined as the cumulative electrical energy consumption in Joules according to the integrated positive power model \cite{verstraten2016energy}:
	 \begin{equation}
	E_{elec,pos} = \int max(0,P_{source}(t))dt
	\end{equation}
\end{enumerate}

\subsubsection{Torque}
The active torque $\tau_a$ is to be kept low and within the maximum and minimum deliverable torque. This is enforced by means of a penalty function which incorporates the 2-norm of the realised values of $\tau_a$:  
 \begin{equation}
J_{torque}= c_2 \cdot || \tau_a ||_2^2
 \end{equation}
Here, $t_f$ denotes the last time segment of the motion.\\

\subsubsection{Stability}
To ensure postural stability a stability criterion is introduced. The leg posture is considered stable when the $x$-coordinate of the centre of mass of the leg is equal to its initial $x$-coordinate, $x=0$, at the end of the jump, i.e. when the centre of mass reaches its maximum height. Also, the motion is assumed to be stable when the mean value of the absolute x-coordinates of the centre of mass equals zero. This is achieved with the minimization of:
 \begin{equation}
J_{stability}  = c_3\cdot x_{CoM}(t_h)^2 + c_4\cdot  \sum^{N}_{i=1}\frac{| x_{CoM}(t)_i |}{N}
 \end{equation}
Here, $t_h$ denotes the point in time where the centre of mass reaches its maximum height. For succesful jumps $t_h=t_f$.\\
\subsection{Algorithm}

The objective criteria described above require information concerning the kinematic and dynamic state of the leg. Both forward and inverse dynamic calculations are to be performed while the leg states are set by adjusting the earlier described $B$-spline joint trajectories. This dependence is managed by the optimisation algorithm. The algorithm in words yields:\\

\begin{itemize}
	\item Provide initial guess trajectory
	\item Create control points\\
	\item[$\diamond$] Create trajectory with $B$-splines
	\item[$\diamond$] Check joint angles, continue if limits are not exceeded \\else, vary control points and repeat $\diamond$ steps
	\item[$\diamond$] Run simulation of motion through forward dynamics
	\item[$\diamond$] Calculate active torques through inverse dynamics
	\item[$\diamond$] Evaluate objective function\\
	\item[$\diamond$] Exit if local minimum is reached, \\ else vary control points and repeat steps with $\diamond$ 
\end{itemize}

	





   \begin{figure}[thpb]
      \centering
      \framebox{\parbox{3in}{Figure of motion sequence
}}
      %\includegraphics[scale=1.0]{figurefile}
      \caption{Caption}
      \label{figurelabel}
   \end{figure}
   
\section{Results}

Results, max height and energy cost for certain height.\\

The optimisation has been performed for the upward movement of the leg performing a jumping motion. The initial position of the leg yields a squatting posture and the optimisation is concluded when the centre of mass reaches its highest point. The initial guess \textbf{describe init guess}  \textbf{add figure of motion sequence}.  

\begin{table}[h]
	\caption{Maximum jump height for different configurations}
	\label{maxheight}
	\begin{center}
		\begin{tabular}{c||c}
		\textit{Configuration}	& \textit{Maximum jump height} [m] \\
			\hline
			Only SEA &   \\
			\hline
			Mono-articulated &  \\
			\hline
			Bi-articulated & 
		\end{tabular}
	\end{center}
\end{table}

\begin{table}[h]
	\caption{Minimum energy use for different configurations}
	\label{maxheight}
	\begin{center}
		\begin{tabular}{c||c}
			\textit{Configuration}	& \textit{Minimum energy use} [J] \\
			\hline
			Only SEA &   \\
			\hline
			Mono-articulated &  \\
			\hline
			Bi-articulated & 
		\end{tabular}
	\end{center}
\end{table}


\section{Discussion}

Comparison of actuation topologies.

\section{Conclusions}

\addtolength{\textheight}{-12cm}   % This command serves to balance the column lengths
                                  % on the last page of the document manually. It shortens
                                  % the textheight of the last page by a suitable amount.
                                  % This command does not take effect until the next page
                                  % so it should come on the page before the last. Make
                                  % sure that you do not shorten the textheight too much.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\section*{ACKNOWLEDGMENT}




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



\bibliographystyle{ieeetr}
\bibliography{lit}
\end{document}
